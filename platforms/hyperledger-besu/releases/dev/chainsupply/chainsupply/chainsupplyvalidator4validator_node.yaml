apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: chainsupplyvalidator4validator-node
  namespace: chainsupply-bes
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: chainsupplyvalidator4validator-node
  interval: 1m
  chart:
   spec:
    chart: platforms/hyperledger-besu/charts/besu-validator-node
    sourceRef:
      kind: GitRepository
      name: flux-bsk
      namespace: flux-bsk
  values:
    replicaCount: 1

    healthcheck:
      readinessthreshold: 100
      readinesscheckinterval: 5

    staticnodes:
      - "enode://2c98e5d64f8cf5b5a3a83f68c97844efc3547b62e38dec3896048dedaecfd952e8d11b6ebd53b4664c0ebd2fbf33e33aa2194162471e0414a9828350e65ea47c@validator1.saikb.dev.aws.blockchaincloudpoc-develop.com:15010"
      - "enode://b24b9eb8e5467ab7d46e592942d60db75fc8f658d7b705ba72e901985e858267006c2ab3cd61c63cfa058367f6d9659524462f50e68b3ab7b4e30dd29b3cf889@validator2.saikb.dev.aws.blockchaincloudpoc-develop.com:15012"
      - "enode://57d4844c682b20d78166a1a19c8039005dc55d624256b34e107f0e596bfed278dc17ee8f2db0b2a720d02358630d59bd52ac67c737056811140d7cccf39135fd@validator3.saikb.dev.aws.blockchaincloudpoc-develop.com:15014"
      - "enode://6c4d14f4c8b8937d4fed1218247c404d82e2e8fd7d9fec3aabac8995b8e85876bd01da6bbdd8b50911717e3a817d4cfa3a67ffbb70b2690e54555d4a0d5b9695@validator4.saikb.dev.aws.blockchaincloudpoc-develop.com:15016"
      - "enode://c173fbeb63b2a89e0a3433f60ef3dfc26a8ca8d15dd5c035d11f004ac455673fe7c809a2f7ab6d3b4046d2764c259e22bb5282a2913d495ebfc50dee51beb6d7@carrier.saikb.dev.aws.blockchaincloudpoc-develop.com:15020"

    metadata:
      namespace: chainsupply-bes
      labels:

    ambassador:
      external_url_suffix: saikb.dev.aws.blockchaincloudpoc-develop.com

    liveliness_check:
      enabled: false
    proxy:
      provider: ambassador
      external_url: saikb.dev.aws.blockchaincloudpoc-develop.com
      p2p: 15016
      rpc: 80

    images:
      node: hyperledger/besu:22.10.2
      alpineutils: ghcr.io/hyperledger/bevel-alpine:latest
      pullPolicy: IfNotPresent

    node:
      name: validator4
      tls: True
      consensus: ibft
      mountPath: /opt/besu/data
      servicetype: ClusterIP
      imagePullSecret: regcred
      ports:
        p2p: 30303
        rpc: 8545
        ws: 8546

      permissioning:
        enabled: False
      
    storage:
      storageclassname: chainsupply-aws-storageclass
      storagesize: 1Gi

    vault:
      address: http://vault.internal.dev.aws.blockchaincloudpoc-develop.com:20002
      secretengine: secretsv2
      secretprefix: data/chainsupply-bes/crypto/validator4
      serviceaccountname: vault-auth
      keyname: data
      tlsdir: tls
      role: vault-role
      authpath: besuchainsupply
      type: hashicorp

    genesis: ewogICJjb25maWciOiB7CiAgICAiY2hhaW5JZCI6IDIwMTgsCiAgICAiY29uc3RhbnRpbm9wbGVmaXhibG9jayI6IDAsCiAgICAiY29udHJhY3RTaXplTGltaXQiOiAyMTQ3NDgzNjQ3LAogICAgImliZnQyIjogewogICAgICAiYmxvY2twZXJpb2RzZWNvbmRzIjogMiwKICAgICAgImVwb2NobGVuZ3RoIjogMzAwMDAsCiAgICAgICJyZXF1ZXN0dGltZW91dHNlY29uZHMiOiAxMAogICAgfQogIH0sCiAgIm5vbmNlIjogIjB4MCIsCiAgInRpbWVzdGFtcCI6ICIweDU4ZWU0MGJhIiwKICAiZ2FzTGltaXQiOiAiMHgxZmZmZmZmZmZmZmZmZiIsCiAgImRpZmZpY3VsdHkiOiAiMHgxIiwKICAiYWxsb2MiOiB7CiAgICAiNzVhMzUwNWNkNTBDZmM0MThlNTk0NThkMEUyM2M4YmQ5ZjZCNTJhMCI6IHsKICAgICAgImJhbGFuY2UiOiAiOTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAiCiAgICB9LAogICAgImU2Njg1NTRjMjhlODE1MzVCODY3OWZmOWRlMTI4MjAzRmRlZGMyMTIiOiB7CiAgICAgICJiYWxhbmNlIjogIjkwMDAwMDAwMDAwMDAwMDAwMDAwMDAwIgogICAgfQogIH0sCiAgImV4dHJhRGF0YSI6ICIweGY4N2VhMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDBmODU0OTRiMzAxYTVjODRjNWQzMmFhNzkyN2E1Y2YwMTdhZDE2MmE4ZTEzMWQxOTQzMzQzYTYyZDVmY2IxMDliN2IwMjUzOTJmNWVkMzk5NDE2ZGJmMTc3OTQyNzg3NWU5MmU4MmQ3NjhkYjFiOTU4NTU1MjE2MWIxNzU3MmE3ODhiOTRlMmZhYmQ1YjFhODQ5NWI1Y2E3MjRmZmRjYWEyNjFiYmUzYWU5NjQ5ODA4NDAwMDAwMDAwYzAiCn0=

   
    labels:  
      service:
        - component: besu
      pvc:
      deployment:
        - owner: bevel
        - component: besu

    metrics:
      enabled: False
      port: 9545    
